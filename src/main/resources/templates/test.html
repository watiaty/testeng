<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body>
<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
<script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
<script>

    function updateTopics() {
        let level = document.getElementById("selectLevels").value;
        let topics = document.getElementById("selectTopics");

        topics = topics.getElementsByTagName("option")


        for (let i = 0; i < topics.length; i++) {

            if (topics.item(i).getAttribute("value2") !== level) {
                topics.item(i).setAttribute("hidden", "true");
            } else {
                topics.item(i).removeAttribute("hidden");
            }
        }
    }

    function updateSubTopics() {
        let topic = document.getElementById("selectTopics").value;
        let subtopics = document.getElementById("selectSubTopics");
        subtopics = subtopics.getElementsByTagName("option")


        for (let i = 0; i < subtopics.length; i++) {
            console.log(topic.value)
            if (subtopics.item(i).getAttribute("value2") !== topic) {
                subtopics.item(i).setAttribute("hidden", "true");
            } else {
                subtopics.item(i).removeAttribute("hidden");
            }
        }
    }

    function updateResult() {
        document.getElementById("result").value = document.getElementById("selectSubTopics").value;
    }

</script>
<form action="#" th:action="@{/test/start}" method="post">
    <select class="form-select form-select-sm" aria-label=".form-select-sm example"
            th:id="selectLevels" onchange="updateTopics()">
        <option th:each="level: ${levels}" th:value="${level.name}" th:text="${level.name}"></option>
    </select>

    <select class="form-select form-select-sm" aria-label=".form-select-sm example"
            th:id="selectTopics" onchange="updateSubTopics()">
        <option th:each="topic: ${topics}" th:value="${topic.id}" th:text="${topic.name}"
                th:value2="${topic.level}"></option>
    </select>

    <select class="form-select form-select-sm" aria-label=".form-select-sm example"
            th:id="selectSubTopics" onchange="updateResult()">
        <option th:each="subtopic: ${subtopics}" th:value="${subtopic.id}" th:value2="${subtopic.topic.id}"
                th:text="${subtopic.name}"></option>
    </select>
    <input type="hidden" id="result" name="subtopic" value="">
    <input type="submit" value="Start test" />
</form>

<tr th:each="test: ${tests}">
    <td th:text="${test.question}"/>
    <td th:text="${test.subtopic.name}"/>
    <br>
</tr>
</body>
</html>